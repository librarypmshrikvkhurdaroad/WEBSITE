<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Library | Catalogue</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  /* Shimmer Loading Effect */
  .shimmer {
    background: linear-gradient(90deg, #eee 25%, #ddd 50%, #eee 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }
  @keyframes shimmer {
    0% { background-position: -200px 0; }
    100% { background-position: 200px 0; }
  }
</style>
</head>

<body class="bg-gray-50 text-gray-800">

<!-- TOP MINISTRY BAR -->
    <div class="w-full bg-blue-800 text-white text-center py-1 text-sm font-semibold tracking-wide flex justify-center items-center">
        <span class="mx-4">‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§æ‡§≤‡§Ø</span>
        <span class="mx-4 border-l border-white pl-4">MINISTRY OF EDUCATION</span>
    </div>

    <!-- MAIN HEADER -->
    <header class="w-full bg-gradient-to-r from-blue-600 to-teal-500 text-white py-6 px-6">

        <div class="max-w-7xl mx-auto grid grid-cols-12 gap-4 items-center">

            <!-- LEFT LOGO -->
            <div class="col-span-2 flex justify-center">
                <img src="assets/2023042118.svg" alt="KV Logo" class="h-20 object-contain">
            </div>

            <!-- CENTER TEXT -->
            <div class="col-span-8">
                <h2 class="text-xl font-bold">‡§™‡•Ä‡§è‡§Æ ‡§∂‡•ç‡§∞‡•Ä ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡•Ä‡§Ø ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§ñ‡•Å‡§∞‡•ç‡§¶‡§æ ‡§∞‡•ã‡§°</h2>
                <h1 class="text-3xl font-extrabold uppercase">PM SHRI KENDRIYA VIDYALAYA KHURDA ROAD</h1>

                <p class="mt-2 text-sm">
                    KV Code: 1150 &nbsp; | &nbsp; CBSE Affiliation No.: 1500008 
                    &nbsp; | &nbsp; CBSE School Code: 19096
                </p>

                <p class="text-sm">
                    An autonomous body under the Ministry of Education, Government of India
                </p>
            </div>

            <!-- RIGHT LOGOS -->
            <div class="col-span-2 flex flex-col items-center space-y-3">
                <img src="assets/swachbrt.svg" alt="Swachh Bharat" class="h-10 object-contain">
                <img src="assets/pmshri.png" alt="PM SHRI" class="h-12 object-contain">
            </div>
          <!-- NAVBAR -->
    <nav class="bg-white shadow sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-red-700">LIBRARY</h1>
            <div class="space-x-6 text-lg">
                <a href="index.html" class="hover:text-blue-600">Home</a>
                <a href="catalogue.html" class="hover:text-blue-600">Catalogue</a>
                <a href="search.html" class="hover:text-blue-600">Search</a>
                <a href="about.html" class="hover:text-blue-600">About</a>
                <a href="contact.html" class="hover:text-blue-600">Contact</a>
            </div>
        </div>
    </nav>

        </div>
    </header>


<main class="max-w-6xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Library Catalogue</h1>

  <!-- Search -->
  <div class="mb-6 flex gap-2">
    <input id="searchInput" class="p-2 border rounded flex-1" placeholder="Search by title, author or ISBN">
    <button id="searchBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Search</button>
  </div>

  <!-- Search Results -->
  <div id="searchResults" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>

  <!-- Full Catalogue -->
  <h2 class="text-2xl font-bold mb-4">All Books</h2>

  <div id="booksGrid"
       class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
</main>

<footer class="bg-blue-900 text-white p-3 text-center mt-8 text-sm">
  ¬© 2025 School Library | Designed with üìö by Students
</footer>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

// ===== Supabase Setup =====
const supabase = createClient(
  "https://gtzmmhowtxvfrbdxpioh.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0em1taG93dHh2ZnJiZHhwaW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NzE4ODgsImV4cCI6MjA4MDU0Nzg4OH0.5Ys003VuHXLngvGQlKNJrDjQybs87H1Vs-hRGNuQPDo"
);

// ===== Google Books API Key =====
const googleApiKey = "AIzaSyCJGgpA594gCg8eOVOpLkhKVcs5K7Jkg38";

// ===== Fetch Metadata =====
async function fetchMetadata(isbn) {
  try {
    const url = `https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}&key=${googleApiKey}`;
    const res = await fetch(url);
    const data = await res.json();
    
    if (!data.items) return null;
    const info = data.items[0].volumeInfo;

    return {
      title: info.title || "Unknown Title",
      author: info.authors ? info.authors.join(", ") : "Unknown Author",
      cover_url:
        info.imageLinks?.thumbnail || info.imageLinks?.smallThumbnail || "assets/placeholder.png"
    };
  } catch {
    return null;
  }
}

// ===== Shimmer Loaders =====
function loadShimmers() {
  const grid = document.getElementById("booksGrid");
  grid.innerHTML = Array(8)
    .fill(`<div class="p-3 bg-white rounded shadow">
      <div class="h-40 w-full rounded shimmer mb-2"></div>
      <div class="h-4 w-3/4 shimmer mb-1"></div>
      <div class="h-3 w-1/2 shimmer"></div>
    </div>`).join("");
}

// ===== Load Catalogue =====
async function loadCatalogue() {
  loadShimmers();
  const grid = document.getElementById("booksGrid");

  const { data, error } = await supabase.from("book_data").select("*");
  if (error || !data.length) {
    grid.innerHTML = `<p class="text-gray-600">No books found.</p>`;
    return;
  }

  const books = await Promise.all(
    data.map(async (b) => {
      const meta = await fetchMetadata(b.isbn);
      return { ...b, ...meta };
    })
  );
grid.innerHTML = books.map(b => `
  <a href="/book.html?isbn=${b.isbn}&acc=${b.acc_no}"
     class="block bg-white rounded shadow hover:shadow-lg transition p-3">
    <img src="${b.cover_url}" class="w-full h-40 object-cover rounded">
    <h3 class="font-semibold mt-2 text-sm">${b.title}</h3>
    <p class="text-xs text-gray-600">${b.author}</p>
    <p class="text-xs mt-1">üìå Acc No: <span class="text-blue-700 font-bold">${b.acc_no}</span></p>
    <p class="text-xs text-gray-500">üìÖ Added: ${b.date_added}</p>
  </a>
`).join("");
}

// ===== Search =====
document.getElementById("searchBtn").addEventListener("click", async () => {
  const q = document.getElementById("searchInput").value.trim();
  const results = document.getElementById("searchResults");

  if (!q) return results.innerHTML = `<p>Enter search query</p>`;

  results.innerHTML = `<p>Searching...</p>`;

  // Search Google Books
  const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(q)}&key=${googleApiKey}`;
  const res = await fetch(url);
  const data = await res.json();

  if (!data.items) return result.innerHTML = `<p>No results found</p>`;

results.innerHTML = data.items.map(item => {
    const info = item.volumeInfo;
    return `
      <div class="bg-white p-3 rounded shadow flex gap-3">
        <img src="${info.imageLinks?.thumbnail || 'assets/placeholder.png'}"
             class="w-20 h-24 object-cover rounded">
        <div>
          <h3 class="font-semibold">${info.title}</h3>
          <p class="text-sm text-gray-600">${info.authors?.join(", ") || "Unknown"}</p>
        </div>
      </div>
    `;
  }).join("");
});

// Run on load
loadCatalogue();
</script>
</body>
</html></body>
</html>>
